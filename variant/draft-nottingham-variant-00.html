<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>HTTP Variants</title><script type="application/javascript">
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc.";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(9);
        } else if (fragid.indexOf("s-") == 0) {
          var postfix = fragid.substring(2);
          if (postfix.startsWith("abstract")) {
            window.location.hash = prefix + postfix;
          } else if (postfix.startsWith("note-")) {
            window.location.hash = prefix + "note." + postfix.substring(5);
          } else {
            window.location.hash = prefix + "section." + postfix;
          }
        } else if (fragid.indexOf("p-") == 0) {
          var r = fragid.substring(2);
          var p = r.indexOf("-");
          if (p >= 0) {
            window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
          }
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../Tools/bower_components/bootstrap/dist/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul ul {
        list-style: none;
      }
      #sidebar {
        position: fixed;
        height: 90%;
        overflow-y: auto;
        font-size: 90%;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
      span.tt {
        font: 11pt consolas, monospace;
        font-size-adjust: none;
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 The “Variants” HTTP Header Field" href="#rfc.section.2"><link rel="Chapter" title="3 IANA Considerations" href="#rfc.section.3"><link rel="Chapter" title="4 Security Considerations" href="#rfc.section.4"><link rel="Chapter" title="5 Acknowledgments" href="#rfc.section.5"><link rel="Chapter" href="#rfc.section.6" title="6 References"><link rel="Appendix" title="A Variants and Defined Content Negotiation Mechanisms" href="#rfc.section.A"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: Saxonica http://www.saxonica.com/"><meta name="keywords" content="Internet-Draft"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Nottingham, M."><meta name="dcterms.identifier" content="urn:ietf:id:draft-nottingham-variant-00"><meta name="dcterms.issued" content="2017-08-30"><meta name="dcterms.abstract" content="This specification introduces the HTTP Variants response header field to communicate what representations are available for a given resource."><meta name="description" content="This specification introduces the HTTP Variants response header field to communicate what representations are available for a given resource."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" id="sidebar" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">draft-nottingham-variant-00</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#the-variants-http-header-field">The “Variants” HTTP Header Field</a><ul><li><a href="#rfc.section.2.1">2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#defining-content-negotiation-using-variants">Defining Content Negotiation Using Variants</a></li><li><a href="#rfc.section.2.2">2.2.</a>&nbsp;&nbsp;&nbsp;<a href="#cache-behaviour">Cache Behaviour</a><ul><li><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#relationship-to-vary">Relationship to Vary</a></li></ul></li><li><a href="#rfc.section.2.3">2.3.</a>&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a><ul><li><a href="#rfc.section.2.3.1">2.3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#single-variant">Single Variant</a></li><li><a href="#rfc.section.2.3.2">2.3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#multiple-variants">Multiple Variants</a></li><li><a href="#rfc.section.2.3.3">2.3.3.</a>&nbsp;&nbsp;&nbsp;<a href="#partial-coverage">Partial Coverage</a></li></ul></li></ul></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#acknowledgments">Acknowledgments</a></li><li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul><li><a href="#rfc.section.6.1">6.1.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.6.2">6.2.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.section.A">A.</a>&nbsp;&nbsp;&nbsp;<a href="#backports">Variants and Defined Content Negotiation Mechanisms</a><ul><li><a href="#rfc.section.A.1">A.1.</a>&nbsp;&nbsp;&nbsp;<a href="#content-encoding">Content-Encoding</a></li><li><a href="#rfc.section.A.2">A.2.</a>&nbsp;&nbsp;&nbsp;<a href="#content-language">Content-Language</a></li></ul></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div></div></div></div><div class="col-md-8 main" role="main"><header><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">Network Working Group</td><td class="text-right">M. Nottingham</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">Fastly</td></tr><tr><td class="text-left">Updates: <a href="https://tools.ietf.org/html/rfc7234">7234</a> (if approved)</td><td class="text-right">August 30, 2017</td></tr><tr><td class="text-left">Intended status: Standards Track</td><td class="text-right"></td></tr><tr><td class="text-left">Expires: March 3, 2018</td><td class="text-right"></td></tr></tbody></table><div id="rfc.title"><h1>HTTP Variants</h1><div class="filename">draft-nottingham-variant-00</div></div></header><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><div id="rfc.abstract.p.1"><p>This specification introduces the HTTP <span class="tt">Variants</span> response header field to communicate what representations are available for a given resource.</p></div></div><section id="rfc.note.1" class="note"><h2><a href="#rfc.note.1">Note to Readers</a></h2><div id="rfc.note.1.p.1"><p><em>RFC EDITOR: please remove this section before publication</em></p></div><div id="rfc.note.1.p.2"><p>The issues list for this draft can be found at <a href="https://github.com/mnot/I-D/labels/variant">https://github.com/mnot/I-D/labels/variant</a>.</p></div><div id="rfc.note.1.p.3"><p>The most recent (often, unpublished) draft is at <a href="https://mnot.github.io/I-D/variant/">https://mnot.github.io/I-D/variant/</a>.</p></div><div id="rfc.note.1.p.4"><p>Recent changes are listed at <a href="https://github.com/mnot/I-D/commits/gh-pages/variant">https://github.com/mnot/I-D/commits/gh-pages/variant</a>.</p></div><div id="rfc.note.1.p.5"><p>See also the draft’s current status in the IETF datatracker, at <a href="https://datatracker.ietf.org/doc/draft-nottingham-variant/">https://datatracker.ietf.org/doc/draft-nottingham-variant/</a>.</p></div></section><section id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><div id="rfc.boilerplate.1.p.1"><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p></div><div id="rfc.boilerplate.1.p.2"><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p></div><div id="rfc.boilerplate.1.p.3"><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p></div><div id="rfc.boilerplate.1.p.4"><p>This Internet-Draft will expire on March 3, 2018.</p></div></section><section id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><div id="rfc.boilerplate.2.p.1"><p>Copyright © 2017 IETF Trust and the persons identified as the document authors. All rights reserved.</p></div><div id="rfc.boilerplate.2.p.2"><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div></section><section id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>HTTP proactive content negotiation (<a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 3.4.1) is increasingly being used to determine not only a response’s content-coding, but also its language, as well as newer axes (for example, see <a href="#I-D.ietf-httpbis-client-hints"><cite title="HTTP Client Hints">[I-D.ietf-httpbis-client-hints]</cite></a>).</p></div><div id="rfc.section.1.p.2"><p>Successfully reusing negotiated responses that have been stored in a HTTP cache requires establishment of a secondary cache key (<a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, Section 4.1) using the Vary header (<a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 7.1.4).</p></div><div id="rfc.section.1.p.3"><p>HTTP’s caching model allows a certain amount of latitude in normalising request header fields to match those stored in the cache, so as to increase the chances of a cache hit while still respecting the semantics of that header. However, this is often inadequate; even with understanding of the headers’ semantics to facilitate such normalisation, a cache does not know enough about the possible alternative representations available on the origin server to make an appropriate decision.</p></div><div id="rfc.section.1.p.4" class="avoidbreakafter"><p>For example, if a cache has stored the following request/response pair:</p></div><div id="rfc.figure.u.1"><pre>
GET /foo HTTP/1.1
Host: www.example.com
Accept-Language: en;q=1.0, fr;q=0.5

HTTP/1.1 200 OK
Content-Type: text/html
Content-Language: fr
Vary: Accept-Language

[French content]
</pre></div><div id="rfc.section.1.p.5"><p>a downstream (client or intermediary) cache that has full knowledge of the semantics of <span class="tt">Accept-Language</span> and <span class="tt">Content-Language</span> will know that a French representation is available, and might be able to infer that an English representation is not available, but it does not know, for example, whether a Japanese representation is available without making another request, thereby incurring possibly unnecessary latency.</p></div><div id="rfc.section.1.p.6"><p>This specification introduces the HTTP <span class="tt">Variants</span> response header field to address this shortcoming, by communicating what representations are available for a given resource.</p></div><section id="notational-conventions"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.1.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div><div id="rfc.section.1.1.p.2"><p>This specification uses the Augmented Backus-Naur Form (ABNF) notation of <a href="#RFC5234"><cite title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</cite></a> with a list extension, defined in Section 7 of <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>, that allows for compact definition of comma-separated lists using a ‘#’ operator (similar to how the ‘*’ operator indicates repetition).</p></div><div id="rfc.section.1.1.p.3"><p>Additionally, it uses the “field-name”, “OWS” and “token” rules from <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</p></div></section></section><section id="the-variants-http-header-field"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#the-variants-http-header-field">The “Variants” HTTP Header Field</a></h2><div id="rfc.section.2.p.1"><p>The <span class="tt">Variant</span> HTTP response header field is used to indicate what other representations are available for a given resource at the time that the response is produced.</p></div><div id="rfc.figure.u.2"><pre>
Variants = 1#( field-name *( OWS ";" OWS token ))
</pre></div><div id="rfc.section.2.p.2"><p>Each <span class="tt">field-name</span> in the list indicates a response header field that carries a value that clients might proactively negotiate for; each <span class="tt">token</span> parameter on the <span class="tt">field-name</span> is an available value.</p></div><div id="rfc.section.2.p.3" class="avoidbreakafter"><p>So, given this example header field:</p></div><div id="rfc.figure.u.3"><pre>
Variants: Content-Encoding;gzip
</pre></div><div id="rfc.section.2.p.4"><p>a recipient can infer that the only content-coding available for that resource is “gzip”.</p></div><div id="rfc.section.2.p.5" class="avoidbreakafter"><p>Given:</p></div><div id="rfc.figure.u.4"><pre>
Variants: content-encoding
</pre></div><div id="rfc.section.2.p.6"><p>a recipient can infer that no content-codings are supported. Note that as always with header field names, it is case-insensitive.</p></div><div id="rfc.section.2.p.7" class="avoidbreakafter"><p>A more complex example:</p></div><div id="rfc.figure.u.5"><pre>
Variants: DPR;1.0;2.0, Content-Language;en ;fr
</pre></div><div id="rfc.section.2.p.8"><p>Here, recipients can infer that two Device Pixel Ratios are available, as well as two content languages. Note that, as with all HTTP header fields that use the “#” list rule (see <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>, Section 7), they might occur in the same header field or separately.</p></div><div id="rfc.section.2.p.9"><p>Note that the ordering of values after the field-name is significant, as it might be used by the header’s algorithm for selecting a response.</p></div><div id="rfc.section.2.p.10"><p>Senders SHOULD consistently send <span class="tt">Variant</span> on all cacheable (as per <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, Section 3) responses for a resource, since its absence will trigger caches to fall back to <span class="tt">Vary</span> processing.</p></div><section id="defining-content-negotiation-using-variants"><h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a>&nbsp;<a href="#defining-content-negotiation-using-variants">Defining Content Negotiation Using Variants</a></h3><div id="rfc.section.2.1.p.1" class="avoidbreakafter"><p>To be usable with Variants, proactive content negotiation mechanisms need to be specified to take advantage of it. Specifically, they:</p></div><div id="rfc.section.2.1.p.2"><ul><li>MUST define a request header field that advertises the clients preferences or capabilities, whose field-name SHOULD begin with “Accept-“</li><li>MUST define a response header field that indicates the result of selection, whose field-name SHOULD begin with “Content-“ and whose field-value SHOULD be a token</li><li>MUST define a way for selecting a result, given a request header field value.</li></ul></div><div id="rfc.section.2.1.p.3"><p><a href="#backports" title="Variants and Defined Content Negotiation Mechanisms">Appendix&nbsp;A</a> fulfils these requirements for some existing proactive content negotiation mechanisms in HTTP.</p></div></section><section id="cache-behaviour"><h3 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a>&nbsp;<a href="#cache-behaviour">Cache Behaviour</a></h3><div id="rfc.section.2.2.p.1"><p>Caches that implement the <span class="tt">Variants</span> header field and the relevant semantics of the field-name it contains SHOULD use that knowledge to either select an appropriate stored representation, or forward the request if no appropriate representation is stored.</p></div><div id="rfc.section.2.2.p.2"><p>They do so by running the defined algorithm to normalise the relevant request header field to a value, which they can then either locate in their cache or fetch from the origin server.</p></div><div id="rfc.section.2.2.p.3"><p>The information in the <span class="tt">Variants</span> header field is usable so long as the response that conveyed it remains fresh (as per <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, Section 4.2). Caches SHOULD use the most recent response’s <span class="tt">Variant</span> field-value(s), but MAY use older ones as long as they are still fresh.</p></div><section id="relationship-to-vary"><h4 id="rfc.section.2.2.1"><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;<a href="#relationship-to-vary">Relationship to Vary</a></h4><div id="rfc.section.2.2.1.p.1"><p>Caches that fully implement this specification MUST ignore request header-fields in the <span class="tt">Vary</span> header for the purposes of secondary cache key calculation (<a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, Section 4.1) when their semantics are understood, implemented as per this specification, and their corresponding response header field is listed in <span class="tt">Variants</span>.</p></div><div id="rfc.section.2.2.1.p.2"><p>Request header fields listed in <span class="tt">Vary</span> that are not implemented in terms of this specification or not present in the <span class="tt">Variants</span> field SHOULD still form part of the secondary cache key.</p></div></section></section><section id="examples"><h3 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a>&nbsp;<a href="#examples">Examples</a></h3><section id="single-variant"><h4 id="rfc.section.2.3.1"><a href="#rfc.section.2.3.1">2.3.1.</a>&nbsp;<a href="#single-variant">Single Variant</a></h4><div id="rfc.section.2.3.1.p.1" class="avoidbreakafter"><p>Given a request/response pair:</p></div><div id="rfc.figure.u.6"><pre>
GET /foo HTTP/1.1
Host: www.example.com
Accept-Language: en;q=1.0, fr;q=0.5

HTTP/1.1 200 OK
Content-Type: image/gif
Content-Language: en
Cache-Control: max-age=3600
Variants: Content-Language;en;de
Vary: Accept-Language
</pre></div><div id="rfc.section.2.3.1.p.2"><p>Upon receipt of this response, the cache knows that two representations of this resource are available, one with a <span class="tt">Content-Language</span> of “en”, and another whose <span class="tt">Content-Language</span> is “de”.</p></div><div id="rfc.section.2.3.1.p.3"><p>Subsequent requests (while this response is fresh) will cause the cache to either reuse this response or forward the request, depending on what the selection algorithm <span class="tt">Accept-Language</span> and <span class="tt">Content-Language</span> determines.</p></div><div id="rfc.section.2.3.1.p.4"><p>So, a request with “en” in <span class="tt">Accept-Language</span> is received and its q-value indicates that it is acceptable, the stored response is used. A request that indicates that “de” is acceptable will be forwarded to the origin, thereby populating the cache. A cache receiving a request that indicates both languages are acceptable will use the q-value to make a determination of what response to return.</p></div><div id="rfc.section.2.3.1.p.5"><p>A cache receiving a request that does not list either language as acceptable (or does not contain an Accept-Language at all) will return the “en” representation (possibly fetching it from the origin), since it is listed first.</p></div><div id="rfc.section.2.3.1.p.6"><p>Note that <span class="tt">Accept-Language</span> is listed in Vary, to assure backwards-compatibility with caches that do not support <span class="tt">Variants</span>.</p></div><div id="rfc.section.2.3.1.p.7"><p>Also, note that response header is listed in <span class="tt">Variants</span>, not the request header (as is the case with <span class="tt">Vary</span>).</p></div></section><section id="multiple-variants"><h4 id="rfc.section.2.3.2"><a href="#rfc.section.2.3.2">2.3.2.</a>&nbsp;<a href="#multiple-variants">Multiple Variants</a></h4><div id="rfc.section.2.3.2.p.1" class="avoidbreakafter"><p>A more complicated request/response pair:</p></div><div id="rfc.figure.u.7"><pre>
GET /bar HTTP/1.1
Host: www.example.net
Accept-Language: en;q=1.0, fr;q=0.5
Accept-Encoding: gzip, br

HTTP/1.1 200 OK
Content-Type: image/gif
Content-Language: en
Content-Encoding: br
Variants: Content-Language;en;jp;de
Variants: Content-Encoding;br;gzip
Vary: Accept-Language, Accept-Encoding
</pre></div><div id="rfc.section.2.3.2.p.2"><p>Here, the cache knows that there are two axes that the response varies upon; <span class="tt">Content-Language</span> and <span class="tt">Content-Encoding</span>. Thus, there are a total of six possible representations for the resource, and the cache needs to consider the selection algorithms for both axes.</p></div><div id="rfc.section.2.3.2.p.3"><p>Upon a subsequent request, if both selection algorithms return a stored representation, it can be served from cache; otherwise, the request will need to be forwarded to origin.</p></div></section><section id="partial-coverage"><h4 id="rfc.section.2.3.3"><a href="#rfc.section.2.3.3">2.3.3.</a>&nbsp;<a href="#partial-coverage">Partial Coverage</a></h4><div id="rfc.section.2.3.3.p.1" class="avoidbreakafter"><p>Now, consider the previous example, but where only one of the varied axes is listed in <span class="tt">Variants</span>:</p></div><div id="rfc.figure.u.8"><pre>
GET /bar HTTP/1.1
Host: www.example.net
Accept-Language: en;q=1.0, fr;q=0.5
Accept-Encoding: gzip, br

HTTP/1.1 200 OK
Content-Type: image/gif
Content-Language: en
Content-Encoding: br
Variants: Content-Encoding;br;gzip
Vary: Accept-Language, Accept-Encoding
</pre></div><div id="rfc.section.2.3.3.p.2"><p>Here, the cache will need to calculate a secondary cache key as per <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>, Section 4.1 – but considering only <span class="tt">Accept-Language</span> to be in its field-value – and then continue processing <span class="tt">Variants</span> for the set of stored responses that the algorithm described there selects.</p></div></section></section></section><section id="iana-considerations"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.3.p.1" class="avoidbreakafter"><p>This specification registers one value in the Permanent Message Header Field Names registry established by <a href="#RFC3864"><cite title="Registration Procedures for Message Header Fields">[RFC3864]</cite></a>:</p></div><div id="rfc.section.3.p.2" class="avoidbreakafter"><ul><li>Header field name: Variants</li><li>Applicable protocol: http</li><li>Status: standard</li><li>Author/Change Controller: IETF</li><li>Specification document(s): [this document]</li><li>Related information:</li></ul></div></section><section id="security-considerations"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2><div id="rfc.section.4.p.1"><p>If the number or advertised characteristics of the representations available for a resource are considered sensitive, the <span class="tt">Variants</span> header by its nature will leak them.</p></div><div id="rfc.section.4.p.2"><p>Note that the <span class="tt">Variants</span> header is not a commitment to make representations of a certain nature available; the runtime behaviour of the server always overrides hints like <span class="tt">Variants</span>.</p></div></section><section id="acknowledgments"><h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#acknowledgments">Acknowledgments</a></h2><div id="rfc.section.5.p.1"><p>This protocol is conceptually similar to, but simpler than, Transparent Content Negotiation <a href="#RFC2295"><cite title="Transparent Content Negotiation in HTTP">[RFC2295]</cite></a>. Thanks to its authors for their inspiration.</p></div><div id="rfc.section.5.p.2"><p>It is also a generalisation of a Fastly feature designed by Rogier ‘DocWilco’ Mulhuijzen.</p></div><div id="rfc.section.5.p.3"><p>Thanks to Hooman Beheshti for his review and input.</p></div></section><section id="rfc.references"><h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a> References</h2><section id="rfc.references.1"><h3 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> Normative References</h3><dl class="dl-horizontal"><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC5234">[RFC5234]</dt><dd>Crocker, D., Ed. and P. Overell, “<a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>”, STD&nbsp;68, RFC&nbsp;5234, <a href="http://dx.doi.org/10.17487/RFC5234">DOI&nbsp;10.17487/RFC5234</a>, January&nbsp;2008, &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.</dd><dt id="RFC7230">[RFC7230]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC&nbsp;7230, <a href="http://dx.doi.org/10.17487/RFC7230">DOI&nbsp;10.17487/RFC7230</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="RFC7231">[RFC7231]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>”, RFC&nbsp;7231, <a href="http://dx.doi.org/10.17487/RFC7231">DOI&nbsp;10.17487/RFC7231</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;.</dd><dt id="RFC7234">[RFC7234]</dt><dd>Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>”, RFC&nbsp;7234, <a href="http://dx.doi.org/10.17487/RFC7234">DOI&nbsp;10.17487/RFC7234</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7234">https://www.rfc-editor.org/info/rfc7234</a>&gt;.</dd></dl></section><section id="rfc.references.2"><h3 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> Informative References</h3><dl class="dl-horizontal"><dt id="I-D.ietf-httpbis-client-hints">[I-D.ietf-httpbis-client-hints]</dt><dd>Grigorik, I., “<a href="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints-04">HTTP Client Hints</a>”, Internet-Draft&nbsp;draft-ietf-httpbis-client-hints-04 (work in progress), April&nbsp;2017.</dd><dt id="RFC2295">[RFC2295]</dt><dd>Holtman, K. and A. Mutz, “<a href="https://tools.ietf.org/html/rfc2295">Transparent Content Negotiation in HTTP</a>”, RFC&nbsp;2295, <a href="http://dx.doi.org/10.17487/RFC2295">DOI&nbsp;10.17487/RFC2295</a>, March&nbsp;1998, &lt;<a href="https://www.rfc-editor.org/info/rfc2295">https://www.rfc-editor.org/info/rfc2295</a>&gt;.</dd><dt id="RFC3864">[RFC3864]</dt><dd>Klyne, G., Nottingham, M., and J. Mogul, “<a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>”, BCP&nbsp;90, RFC&nbsp;3864, <a href="http://dx.doi.org/10.17487/RFC3864">DOI&nbsp;10.17487/RFC3864</a>, September&nbsp;2004, &lt;<a href="https://www.rfc-editor.org/info/rfc3864">https://www.rfc-editor.org/info/rfc3864</a>&gt;.</dd></dl></section></section><section id="backports"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">A.</a>&nbsp;<a href="#backports">Variants and Defined Content Negotiation Mechanisms</a></h2><div id="rfc.section.A.p.1"><p>This appendix defines the required information to use existing proactive content negotiation mechanisms (as defined in <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 5.3) with the <span class="tt">Variants</span> header field.</p></div><section id="content-encoding"><h3 id="rfc.section.A.1"><a href="#rfc.section.A.1">A.1.</a>&nbsp;<a href="#content-encoding">Content-Encoding</a></h3><div id="rfc.section.A.1.p.1"><p>When negotiating for the <span class="tt">Content-Encoding</span> response header field’s value, the applicable request header field is <span class="tt">Accept-Encoding</span>, as per <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a> Section 5.3.4.</p></div><div id="rfc.section.A.1.p.2"><p>Caches SHOULD use Quality Values (<a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 5.3.1) to determine whether there is an acceptable stored response, in conjunction with the information carried in the Variants response header field.</p></div><div id="rfc.section.A.1.p.3"><p>If no acceptable representation can be found using quality values, the first value listed in the relevant <span class="tt">Variant</span> field-value SHOULD be selected.</p></div><div id="rfc.section.A.1.p.4"><p>The “identity” encoding (which as per {{!RFC7231 Section 5.3.4 represents “no encoding”) is always implicitly available at the lowest priority; if the server wishes to change its priority, it can be explicitly listed. Responses are not required to carry “identity” in the <span class="tt">Content-Encoding</span> response header field by this specification.</p></div><div id="rfc.section.A.1.p.5"><ul><li>TODO: x-</li><li>TODO: normalisations</li></ul></div><div id="rfc.section.A.1.p.6"><p>Caches MAY assign a minimum quality value to trigger a request to origin. For example, a cache might decide to send a request to origin if there is not a stored response to which the client has assigned a quality value above 0.2.</p></div></section><section id="content-language"><h3 id="rfc.section.A.2"><a href="#rfc.section.A.2">A.2.</a>&nbsp;<a href="#content-language">Content-Language</a></h3><div id="rfc.section.A.2.p.1"><p>When negotiating for the <span class="tt">Content-Language</span> response header field’s value, the applicable request header field is <span class="tt">Accept-Language</span>, as per <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a> Section 5.3.5.</p></div><div id="rfc.section.A.2.p.2"><p>Caches SHOULD use Quality Values (<a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 5.3.1) to determine whether there is an acceptable stored response, in conjunction with the information carried in the Variants response header field.</p></div><div id="rfc.section.A.2.p.3"><ul><li>TODO: stripping localisation</li><li>TODO: other normalisations</li></ul></div><div id="rfc.section.A.2.p.4"><p>If no acceptable representation can be found using quality values, the first value listed in the relevant <span class="tt">Variant</span> field-value SHOULD be selected.</p></div><div id="rfc.section.A.2.p.5"><p>Caches MAY assign a minimum quality value to trigger a request to origin. For example, a cache might decide to send a request to origin if there is not a stored response to which the client has assigned a quality value above 0.2.</p></div></section></section><section id="rfc.authors" class="avoidbreakinside"><h2><a href="#rfc.authors">Author's Address</a></h2><address><b>Mark Nottingham</b><br>Fastly<br>EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a><br>URI: <a href="https://www.mnot.net/">https://www.mnot.net/</a></address></section></div></div></div><script src="../Tools/bower_components/jquery/dist/jquery.min.js"></script><script src="../Tools/bower_components/bootstrap/dist/js/bootstrap.min.js"></script></body></html>