<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.30 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfc2629xslt/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-identifying-protocols-00" category="bcp">

  <front>
    <title>Identifying Protocols</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization></organization>
      <address>
        <email>mnot@mnot.net</email>
        <uri>https://www.mnot.net/</uri>
      </address>
    </author>

    <date year="2017"/>

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This document explores different means of identifying protocols, the reasons for doing so, and
defines best practices for their use.</t>



    </abstract>


    <note title="Note to Readers">


<t>The issues list for this draft can be found at <eref target="https://github.com/mnot/I-D/labels/identifying-protocols">https://github.com/mnot/I-D/labels/identifying-protocols</eref>.</t>

<t>The most recent (often, unpublished) draft is at <eref target="https://mnot.github.io/I-D/identifying-protocols/">https://mnot.github.io/I-D/identifying-protocols/</eref>.</t>

<t>Recent changes are listed at <eref target="https://github.com/mnot/I-D/commits/gh-pages/identifying-protocols">https://github.com/mnot/I-D/commits/gh-pages/identifying-protocols</eref>.</t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>For a variety of reasons, it’s often necessary to identify Internet protocols. This includes:</t>

<t><list style="symbols">
  <t>Assuring that the endpoints positively support the intended protocol (e.g., to avoid cross-protocol attacks)</t>
  <t>Negotiating the use of a protocol (or protocol version)</t>
  <t>Configuring protocol details, such as transport parameters, or optional features</t>
  <t>Discriminating traffic based upon protocol, for policy enforcement or quality of service</t>
  <t>Establishing a name space for extensions and other protocol artefacts</t>
</list></t>

<t>Internet standards define a number of ways to identify a protocol. Less is said about the
appropriate use of these identifiers for various purposes. This document defines best practices for
the use of several kinds of protocol identifiers.</t>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in
<xref target="RFC2119"/>.</t>

</section>
</section>
<section anchor="magic" title="“Magic”">

<t>It’s very common for protocols to specify an initial set of octets that are to be sent by endpoints
on a connection, so-called “magic.”</t>

<t>Magic is best used to assure that the protocol being used is unambiguous, to prevent cross-protocol
attacks as well as plain misconfiguration.</t>

<t>For example, HTTP/2 <xref target="RFC7540"/> uses a “connection preface” (Section 3.5) for this purpose; it
sends the string:</t>

<t><list style='empty'>
  <t>PRI * HTTP/2.0\r\n\r\nSM\r\n\r\n</t>
</list></t>

<t>This was carefully designed to quickly and unambiguously break as many HTTP/1.1 servers as
possible, so that if a HTTP/2 client were to accidentally connect to a HTTP/1.1 server, it would
fail quickly and as reliably as possible. This aids error recovery.</t>

<t>Magic is less helpful for negotiating the protocol to be used. For example, the PROXY protocol
uses magic to preface metadata onto a connection. However, the client needs to be
configured to use the PROXY protocol on an endpoint-by-endpoint basis, since negotiation will fail
otherwise.</t>

<t>Since Magic only applies to the data stream it is used within, it is also less than useful for
negotiating alternative transports. However, a protocol can overload magic to perform some kinds of
configuration. This is effectively what the HTTP/2 SETTINGS frame does.</t>

</section>
<section anchor="port-numbers" title="Port Numbers">

<t>Transport protocols like TCP <xref target="RFC0793"/> and UDP <xref target="RFC0768"/> use port numbers to identify
protocols. Historically, port numbers have been used to identify the application in use, which maps
roughly to the protocol.</t>

<t>Generally, a protocol registers a “default” port that is to be used for it; this allows a client to
connect to a server for a given purpose only using that server’s name.</t>

<t>However, there are cases where different applications use the same protocol on different ports
(e.g, SMTP on port 25, submission on port 587); conversely, different applications sometimes use
the same protocol on the same port (e.g., countless applications using HTTP on ports 80 and 443).</t>

<t>The binding between a port number and a protocol is also weak; just because HTTPS is allocated port
443, it isn’t constrained to operate only on that port (and is commonly deployed on other ports as
well). Likewise, ports are sometimes used for purposes other than that allocated; again using 443
as an example, other protocols are known to use it for firewall traversal.</t>

<t>This means that while they serve their primary purpose of multiplexing multiple protocols onto the
same host well, port numbers have limited utility for the purposes of protocol identification
outlined above.</t>

<t>The most commonly cited case, discriminating traffic in the network, can only be described as “best
effort” generously, especially in these times of pervasive encryption <xref target="RFC7258"/>. The port number
that traffic uses is no guarantee of the application or protocol in use. At best, it is an
indicator of <spanx style="emph">possible</spanx> application and/or protocol.</t>

<section anchor="service-names" title="Service Names">

<t>DNS SRV <xref target="RFC2782"/> introduced Service Names as as complement to and extension of port numbers.
They are managed in the same registry <xref target="RFC0635"/>:</t>

<figure><artwork><![CDATA[
Service names are the unique key in the Service Name and Transport
Protocol Port Number registry.  This unique symbolic name for a
service may also be used for other purposes, such as in DNS SRV
records.
]]></artwork></figure>

<t>That specification goes on to recommend:</t>

<t><list style='empty'>
  <t>Because the port number space is finite (and therefore conservation is an important goal), the
alternative of using service names instead of port numbers is RECOMMENDED whenever possible.</t>
</list></t>

<t>In other words, service names allow a host to dynamically nominate the port(s) to be used, rather
than relying upon a default port.</t>

<t>Being evolved from them, service names generally have the same granularity and scope of purpose as
port numbers; that is, they’re fairly “high-level”, occupying conceptual space somewhere between
coarsely-defined protocols and applications.</t>

<t>Service names have only been used with SRV to date. They are difficult to retrofit onto existing
protocols, since already-deployed clients will not support them, and therefore fail to work if they
are used.</t>

<t>So, stop asking for HTTP to support SRV. It’s not going to happen.</t>

<t>Service names’ conceptually “high” level and binding to SRV makes them useful for negotiating a protocol (or protocol suite), but less useful for negotiating a specific version or configuration of that protocol, since</t>

</section>
</section>
<section anchor="uri-schemes" title="URI Schemes">

<t>URI schemes <xref target="RFC3986"/> occur as part of a resource identifier that’s often (but not always) end
user-visible.</t>

<t>The primary purpose of URIs is identification.</t>

</section>
<section anchor="alpn-protocol-ids" title="ALPN Protocol IDs">

<t>A newer form of protocol identification was introduced by ALPN <xref target="RFC7301"/>, which establishes a
name space of Protocol Identifiers.</t>

<t>The original purpose of ALPN Protocol IDs was to identify the “next” protocol inside a TLS
connection, so that HTTP could negotiate the use of HTTP/2 instead of HTTP/1. HTTP/2 quickly
adopted this name space for other purposes, including the identification of protocols in
Alternative Services <xref target="RFC7838"/>.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>This document has no requirements for IANA.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor='RFC2119' target='http://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor='RFC7540' target='http://www.rfc-editor.org/info/rfc7540'>
<front>
<title>Hypertext Transfer Protocol Version 2 (HTTP/2)</title>
<author initials='M.' surname='Belshe' fullname='M. Belshe'><organization /></author>
<author initials='R.' surname='Peon' fullname='R. Peon'><organization /></author>
<author initials='M.' surname='Thomson' fullname='M. Thomson' role='editor'><organization /></author>
<date year='2015' month='May' />
<abstract><t>This specification describes an optimized expression of the semantics of the Hypertext Transfer Protocol (HTTP), referred to as HTTP version 2 (HTTP/2).  HTTP/2 enables a more efficient use of network resources and a reduced perception of latency by introducing header field compression and allowing multiple concurrent exchanges on the same connection.  It also introduces unsolicited push of representations from servers to clients.</t><t>This specification is an alternative to, but does not obsolete, the HTTP/1.1 message syntax.  HTTP's existing semantics remain unchanged.</t></abstract>
</front>
<seriesInfo name='RFC' value='7540'/>
<seriesInfo name='DOI' value='10.17487/RFC7540'/>
</reference>



<reference  anchor='RFC0793' target='http://www.rfc-editor.org/info/rfc793'>
<front>
<title>Transmission Control Protocol</title>
<author initials='J.' surname='Postel' fullname='J. Postel'><organization /></author>
<date year='1981' month='September' />
</front>
<seriesInfo name='STD' value='7'/>
<seriesInfo name='RFC' value='793'/>
<seriesInfo name='DOI' value='10.17487/RFC0793'/>
</reference>



<reference  anchor='RFC0768' target='http://www.rfc-editor.org/info/rfc768'>
<front>
<title>User Datagram Protocol</title>
<author initials='J.' surname='Postel' fullname='J. Postel'><organization /></author>
<date year='1980' month='August' />
</front>
<seriesInfo name='STD' value='6'/>
<seriesInfo name='RFC' value='768'/>
<seriesInfo name='DOI' value='10.17487/RFC0768'/>
</reference>



<reference  anchor='RFC7258' target='http://www.rfc-editor.org/info/rfc7258'>
<front>
<title>Pervasive Monitoring Is an Attack</title>
<author initials='S.' surname='Farrell' fullname='S. Farrell'><organization /></author>
<author initials='H.' surname='Tschofenig' fullname='H. Tschofenig'><organization /></author>
<date year='2014' month='May' />
<abstract><t>Pervasive monitoring is a technical attack that should be mitigated in the design of IETF protocols, where possible.</t></abstract>
</front>
<seriesInfo name='BCP' value='188'/>
<seriesInfo name='RFC' value='7258'/>
<seriesInfo name='DOI' value='10.17487/RFC7258'/>
</reference>



<reference  anchor='RFC2782' target='http://www.rfc-editor.org/info/rfc2782'>
<front>
<title>A DNS RR for specifying the location of services (DNS SRV)</title>
<author initials='A.' surname='Gulbrandsen' fullname='A. Gulbrandsen'><organization /></author>
<author initials='P.' surname='Vixie' fullname='P. Vixie'><organization /></author>
<author initials='L.' surname='Esibov' fullname='L. Esibov'><organization /></author>
<date year='2000' month='February' />
<abstract><t>This document describes a DNS RR which specifies the location of the server(s) for a specific protocol and domain.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='2782'/>
<seriesInfo name='DOI' value='10.17487/RFC2782'/>
</reference>



<reference  anchor='RFC0635' target='http://www.rfc-editor.org/info/rfc635'>
<front>
<title>Assessment of ARPANET protocols</title>
<author initials='V.' surname='Cerf' fullname='V. Cerf'><organization /></author>
<date year='1974' month='April' />
<abstract><t>Theoretical and practical motivation for redesign.  Multipacket   messages; host retransmission; duplicate detection; sequencing;   acknowledgement.</t></abstract>
</front>
<seriesInfo name='RFC' value='635'/>
<seriesInfo name='DOI' value='10.17487/RFC0635'/>
</reference>



<reference  anchor='RFC3986' target='http://www.rfc-editor.org/info/rfc3986'>
<front>
<title>Uniform Resource Identifier (URI): Generic Syntax</title>
<author initials='T.' surname='Berners-Lee' fullname='T. Berners-Lee'><organization /></author>
<author initials='R.' surname='Fielding' fullname='R. Fielding'><organization /></author>
<author initials='L.' surname='Masinter' fullname='L. Masinter'><organization /></author>
<date year='2005' month='January' />
<abstract><t>A Uniform Resource Identifier (URI) is a compact sequence of characters that identifies an abstract or physical resource.  This specification defines the generic URI syntax and a process for resolving URI references that might be in relative form, along with guidelines and security considerations for the use of URIs on the Internet.  The URI syntax defines a grammar that is a superset of all valid URIs, allowing an implementation to parse the common components of a URI reference without knowing the scheme-specific requirements of every possible identifier.  This specification does not define a generative grammar for URIs; that task is performed by the individual specifications of each URI scheme.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='STD' value='66'/>
<seriesInfo name='RFC' value='3986'/>
<seriesInfo name='DOI' value='10.17487/RFC3986'/>
</reference>



<reference  anchor='RFC7301' target='http://www.rfc-editor.org/info/rfc7301'>
<front>
<title>Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</title>
<author initials='S.' surname='Friedl' fullname='S. Friedl'><organization /></author>
<author initials='A.' surname='Popov' fullname='A. Popov'><organization /></author>
<author initials='A.' surname='Langley' fullname='A. Langley'><organization /></author>
<author initials='E.' surname='Stephan' fullname='E. Stephan'><organization /></author>
<date year='2014' month='July' />
<abstract><t>This document describes a Transport Layer Security (TLS) extension for application-layer protocol negotiation within the TLS handshake. For instances in which multiple application protocols are supported on the same TCP or UDP port, this extension allows the application layer to negotiate which protocol will be used within the TLS connection.</t></abstract>
</front>
<seriesInfo name='RFC' value='7301'/>
<seriesInfo name='DOI' value='10.17487/RFC7301'/>
</reference>



<reference  anchor='RFC7838' target='http://www.rfc-editor.org/info/rfc7838'>
<front>
<title>HTTP Alternative Services</title>
<author initials='M.' surname='Nottingham' fullname='M. Nottingham'><organization /></author>
<author initials='P.' surname='McManus' fullname='P. McManus'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke'><organization /></author>
<date year='2016' month='April' />
<abstract><t>This document specifies &quot;Alternative Services&quot; for HTTP, which allow an origin's resources to be authoritatively available at a separate network location, possibly accessed with a different protocol configuration.</t></abstract>
</front>
<seriesInfo name='RFC' value='7838'/>
<seriesInfo name='DOI' value='10.17487/RFC7838'/>
</reference>




    </references>



  </back>
</rfc>

